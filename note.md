---
typora-root-url: noteassets
---

# Unity 2D 的一些笔记

## Isometric 相关

### 个人梳理：

![pic1](/pic1.jpg)

Isometric 最早接触大概是在2008年，当时加入的游戏公司立项制作的一款游戏，当时称其为 2.5D 游戏。使用 Flash 开发，当时大环境是社交游戏大热，普通的平面游戏画面已经不能满足用户需求。当时 Flash 有本 Isometric 相关的书籍也较火，所以其实国内各家以社交游戏起家的公司都开始作相关研发。当时作为一个 Flasher，但游戏行业经验并不丰富的准菜鸟，并没有涉及核心代码的研发，不过也旁观与参与了一些技术方面的讨论认证。

> 具体高宽比是有一套计算公式的，好像是如果宽是1像素，高就是0.515xxx像素好像，不过一般最后结论都是1:0.5这种比例，方便计算。

这种等视距技术，或者叫它2.5D，或者叫它伪3D的画面，优点就是看起来像3D了，性能上又没有3D那样对配置要求这么高。缺点么就是其实它不是3D（-_-b好像是废话）当前技术上的主要难点就是排序规则，一般有二种做法：

方案1：强制所有元素都是一个单元格，那么可以简单的通过Y坐标排序。

方案2：元素可以是长方形，每个元素都需要通过计算它周围所有与自己会发生遮挡关系的单元格里面有没有物体，生成一个排序列表。（优点是不再局限于物品只能 1X1 大小了，缺点是排序规则较复杂）

当然无论是上述哪种方案，都无法达成一种特殊需求，即物品形式不是方形，而是类似L形的物品排序。（当然也可以利用第一种方法解决长方形的方案，即将物品切割成多个 1X1 方格，不过这个应该算作方案3）

方案1实现逻辑：

```
因为每个元素都只占一个单元格，那么根据单元格坐标(X,Y)，简单的根据Y坐标排序即可。
```

方案2实现逻辑：

```
根据单元格坐标开始遍历，只占一个单元格的仍然按方案1直接往排序数组里面塞即可。当碰上大于1单元格的元素，需要将其单元格四周涉及遮挡关系的所有单元格遍历一遍，然后根据遮挡和被遮挡关系排序。如果涉及单元格还是一个大于1的元素，则继续递归遍历。
```

方案3实现逻辑：

```
对于大于1单元格的元素，利用动态绘制的原理，将元素分割成多个1单元格的元素，然后直接根据Y坐标排序即可。主要难点在于，每个单元格应该绘制多高（宽是限制好的一单元格宽度）。
```

最后项目选用的是方案2，而我当时研究是方案3。其中方案3中的动态绘制方法成为了未来我经常使用的一种方法。

之后换了公司，也接触过几个项目，也碰到过主程想自己实现最后项目进度比较糟糕的情况，当时是推荐使用一套成熟的Iso方案。再之后自己项目也使用过方案1.

所以在公司项目中选用技术方案，成熟稳定最重要。自己去摸索，当然对自身提高最有好处，但这种是对发你工资的公司的一种不负责。

### Unity 中的 Isometric：

从 Unity 2018.3 开始，官方提供了一套完整的 Isometric Tilemap 方案。

它主要有二大部分组成：

#### 1. Grid

在 Hierarchy 窗口中添加 2D Object -> Isometric Tilemap 创建。会在场景中创建一个 Grid 和 Tilemap。

Grid 一个场景仅有一个，它主要负责定义网格中每个单元格的大小，间距等。

- Cell Size（单元格尺寸）：定义网格中每个单元格的大小。
- Cell Gap （单元格间距）：定义网格中每个单元格之间的距离。
- Cell Layout （单元格布局）：定义网格中单元格的布局方式。
  1. Rectangle （矩形）
  2. Hexagon （六角形）
  3. Isometric （等视距）
  4. Isometric Z as Y （等视距，通过 Z 轴影响高度并体现到渲染顺序中）
- Cell Swizzle （单元格布局方向调整）：目前就是用默认的 XYZ ，尚没有碰到需要改变坐标轴的场景。

Tilemap 可以多次添加，可以认为一个 Tilemap 就是一层。

- Animation Frame Rate：动画帧率。
- Color：可以统一调整这一层的颜色。
- Tile Anchor：锚点，调整它用来元素与单元格对齐。

另外还有一个 Tilemap Renderer 组件。

- Sort Order：排序模式，默认是 Top Right。
- Mode：Chunk 是批量，Individual 是单独渲染。
- Detect Chunk Culling Bounds
- Chunk Culling Bounds
- Mask Interaction
- Material：使用的材质，测试 2D 灯光时需要修改这项。
- Additional Settings
  - Sorting Layer：2D 的渲染排序，一般会按后中前的顺序定义若干个层。
  - Order in Layer：在当前 Layer 的渲染顺序。如：同样是在背景层，地面层应该永远在花草泥土装饰的下面。

#### 2. Tile Palette

调色板，和绘图软件中的调色板类似，你可以将各种素材添加进调色板。进阶的还能自定义笔刷规则等。

通过 Window / 2D / Tile Palette 打开界面。

Create New Palette：创建一个调色板

- Name：起个名字
- Grid：适用的网格布局类型
- Cell Size：单元格大小

然后选择一个目录保存这个调色板文件。可以往里面添加素材了，每个素材会对应生成一个 asset 文件。

> 注意：创建类型为 Isometric 的调色板时，单元格大小会切换成 Manual，大小会设置成 (1,0.5,1)。

调色板的注意事项：

1. 创建类型为 Isometric 的调色板时，单元格大小会自动切换成 Manual，大小会设置成 (1,0.5,1)。
2. 应该尽量将相关的 Texture 打到一个图集中。
3. 图集中一些需要注意的设置：
   - Texture Type：设置为 Sprite (2D and UI)。
   - Sprite Mode：如果是多个 Texture 打到一个图集中，需要指定为 Multiple。
   - Pixels Per Unit：如果你一个单元格中的素材尺寸是 64X32 的，就需要设置成 64。默认为 100。
   - Filter Mode：默认为 Bilinear，如果是像素图应该改成 Point (no filter)。
   - 最后别不要忘了 Apply。
4. 拖入的素材如果是平面的（地面，地板）则不需要额外设置。如果素材是视觉上有高度的（如城墙，立方体），则需要打开调色板文件（从 Project 中选中调色板的 Prefab，然后双击或者 Open Prefab），选中里面的 Layer1，并修改 Tile Anchor 为 (1,1,0)。
5. 要修改调色板里面元素的位置，或者删除等操作。要先在 Tile Palette 窗口中选中 Edit，然后通过工具栏操作。比如移动位置，需要先点击工具栏中的 S ，然后选中一个元素，再点击工具栏中的 M，然后拖动。(S,M也是键盘快捷键)修改完成后，再点击 Edit（如果有修改 Edit 后面会有一个 *）即可保存。

#### 3. 处理遮挡

默认情况下 Tilemap Renderer 中的 Mode 在 Chunk 下能够表现的挺好的。